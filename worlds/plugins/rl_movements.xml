<?xml version="1.0" encoding="iso8859-15"?>
<!DOCTYPE muclient [
  <!ENTITY prefijo "(?:(?:.*?)(?:\&gt; |\] |\} )|)" >
  <!ENTITY intens "(?:(con |)(débilmente |poca fuerza |fuerza |mucha fuerza |violentamente |fuerza sobrehumana |fuerza divina |increíble potencia |cólera titánica |))" >
  ]>
<!-- Saved on lunes, febrero 29, 2016, 5:53 p.m. -->
<!-- MuClient version 4.84 -->

<!-- Plugin "rl_movements" generated by Plugin Wizard -->

<muclient>
<plugin
   name="rl_movements"
   author="Francisco R. Del Roio"
   id="a0c9598da9d3d0b771e847dd"
   language="Lua"
   purpose="Permite moverse sin usar el keypad"
   date_written="2016-02-29 17:49:36"
   requires="4.84"
   version="1.0"
   >
<description trim="y">
<![CDATA[
Este plugin está diseñado para funcionar con el MUD Reinos de Leyenda, y permite moverse sin tener que usar el keypad. Además, incluye algunos triggers que hacen los viajes mas cómodos.

    http://reinosdeleyenda.es
]]>
</description>

</plugin>


<triggers>
  <trigger
   enabled="n"
   match="^&prefijo;(?P&lt;room_name&gt;.*?) \[(?P&lt;room_exits&gt;[a-z\\\|\-\~\*\,]*?)\]"
   name="mirar_salidas"
   regexp="y"
   sequence="100"
   script="OnRoom"
  >
  </trigger>
  
  <trigger
   match="^(?:\s+)Los Dioses te dan la bienvenida a sus Reinos de Leyenda, (\w+).(?:\s+)$"
   enabled="y"
   sequence="100"
   regexp="y"
   send_to="12"
  >
  <send>EnableTrigger("mirar_salidas", true)</send>
  </trigger>
  
  <trigger 
   match="LPmud version: *."
   enabled="y"
   sequence="100"
   send_to="12"
  >
  <send>EnableTrigger("mirar_salidas", false)</send>
  </trigger>
</triggers>

<!--  Get our standard constants -->

<include name="constants.lua"/>

<script>
<![CDATA[
require("rl_stuff")
require("re")
require "ppi"

local nav_right = false
local quiet = false
local last_move = nil
local attempts = 2
local salidas = nil

local nav_left_keys = {
	["ALT+w"]= "n",
	["ALT+e"]= "ne",
	["ALT+d"]= "e",
	["ALT+c"]= "se",
	["ALT+x"]= "s",
	["ALT+z"]= "so",
	["ALT+a"]= "o",
	["ALT+q"]= "no",
	["ALT+f"]= "ar",
	["ALT+v"]= "ab",
	}

local std_dirs = {
	norte = "std/salidas/norte.ogg",
	noreste = "std/salidas/noreste.ogg",
	este = "std/salidas/este.ogg",
	sureste = "std/salidas/sureste.ogg",
	sur = "std/salidas/sur.ogg",
	sudoeste = "std/salidas/sudoeste.ogg",
	oeste = "std/salidas/oeste.ogg",
	noroeste = "std/salidas/noroeste.ogg",
	arriba = "std/salidas/arriba.ogg",
	abajo = "sounds/std/salidas/abajo.ogg"
}

s_dirs = {
	n = std_dirs.norte,
	ne = std_dirs.noreste,
	e = std_dirs.este,
	se = std_dirs.sureste,
	s = std_dirs.sur,
	so = std_dirs.sudoeste,
	o = std_dirs.oeste,
	no = std_dirs.noroeste,
	ar = std_dirs.arriba,
	ab = std_dirs.abajo
}

-- Esto es para agregar salidas no estándar contra el mapper
local no_estandar = {
	["cueva"] = true,
	["grieta"] = true,
	["gruta"] = true,
	["tienda"] = true,
	["herreria"] = true,
	["sastretia"] = true,
	["taller"] = true
	
	-- Faltan unos cuantos
}

local mapper = nil

function OnPluginListChanged()
	RLStuffListChanged()
end -- ListChanged

function OnPluginInstall()
	OnPluginEnable()
end -- OnPluginInstall

function OnPluginClose()
	OnPluginDisable()
end --  OnPluginRemove

function OnPluginSend(texto)
	local dir, estado
	
	if not salidas then return true end
	
	if texto:match("^%a+$") then
		dir = texto:match("^%a+$")
		
		-- Si la salida no existe directamente no aparece aquí.
		if not salidas[dir] then
			return true
		end -- if
		
		if salidas[dir] == "c" then
			return false
		end -- salidas
	end -- texto
	
	return true
end -- function

function OnPluginEnable()
	if not nav_right then
		for k, v in pairs(nav_left_keys) do
			Accelerator(k, v)
		end
	end -- nav_right
	
	AcceleratorTo("ALT+s", "mostrar_salidas()", sendto.script)
	
	if IsConnected() then
		EnableTrigger("mirar_salidas", true)
	end -- if
end -- OnPluginEnable

function OnPluginDisable()
	if not nav_right then
		for k, v in pairs(nav_left_keys) do
			Accelerator(k, "")
		end -- nav_left_keys
	end
	
	Accelerator("ALT+s", "")
end -- OnPluginDisable

]]>
</script>

</muclient>
