<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient [
  <!ENTITY prefijo "(?:(?:.*?)(?:\&gt; |\] |\} )|)" >
  <!ENTITY intens "(?:(con (poca fuerza|fuerza|mucha fuerza|increíble potencia|fuerza sobrehumana|fuerza divina|cólera titánica)|débilmente|violentamente) |)" >
  <!ENTITY parte "(el|la|una|un) ([a-záéíóú]+)" >
]>
<!-- Saved on domingo, enero 20, 2019, 9:39 p. m. -->
<!-- MuClient version 5.05 -->

<!-- Plugin "rl_combate" generated by Plugin Wizard -->

<muclient>
<plugin
   name="rl_combate"
   author="Francisco R. Del Roio"
   id="7d460569ef234e2fbbcef269"
   language="Lua"
   purpose="Proporciona reacciones sonoras para eventos relacionados con el combate de reinos de leyenda."
   date_written="2019-01-20 21:37:46"
   requires="5.05"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<triggers>
  <trigger
   enabled="y"
   match="^&prefijo;\* (.*?) te golpea en &parte; sin producir ningún daño\.$"
   regexp="y"
   name="generico_enemigo_parado"
   sequence="100"
   script="on_fallar"
  >
  </trigger>
</triggers>

<triggers>
  <!-- Grupo que contiene triggers para armas cortantes y relacionadas -->

  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\# (Cortas|Sesgas|Rajas) &intens;en (?:&parte; |)a (.*?)\.$"
   name="cortante_propio"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\# Realizas un salto hacia (.*?) descargando un tremendo corte crítico con brutalidad en (?:&parte;)\.$"
   name="cortante_propio_critico"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^¡Tu golpe causa una profunda herida a (.*?) en (.*?)\!$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play_sound("combate/armas/cortantes/sangra.ogg", 50)</send>
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\* (.*?) te (?:corta|sesga|raja) &intens;en &parte;\.$"
   name="cortante_enemigo"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\* (.*?) te intenta (rajar|sesgar|cortar) en &parte;\, pero logras esquivar su ataque\.$"
   name="cortante_enemigo_esquivado"
   regexp="y"
   sequence="100"
   script="on_fallar"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\* (.*?) te intenta (rajar|sesgar|cortar) en &parte;\, pero logras parar críticamente su ataque\.$"
   name="cortante_enemigo_parado_critico"
   regexp="y"
   sequence="100"
   script="on_fallar"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^\* (.*?) te intenta (rajar|sesgar|cortar) en &parte;\, pero logras parar su ataque\.$"
   name="cortante_enemigo_parado"
   regexp="y"
   sequence="100"
   script="on_fallar"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\* (.*?) salta sobre ti descargando un brutal golpe crítico en &parte; haciendo manar la sangre a borbotones\.$"
   name="cortante_enemigo_critico"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^¡Te desangras a causa de tu herida en &parte;\!$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play_sound("combate/armas/cortantes/sangra.ogg", -50)</send>
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^&prefijo;\# Entierras tu sable en &parte; de (.*?) destrozando órganos vitales\.$"
   name="sable_propio_critico"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Cortantes"
   match="^\# Deslizas tu sable sobre &parte; de (.*?) dejándole un corte sanguinolento\.$"
   regexp="y"
   name="sable_propio"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
</triggers>

<triggers>
  <!-- Armas penetrantes -->

  <trigger
   enabled="y"
   group="Penetrante"
   match="^&prefijo;\# (Perforas|Pinchas) &intens;en (&parte; |)a (.*?)\.$"
   name="penetrante_propio"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Penetrantes"
   match="^&prefijo;\* (.*?) te (perfora|pincha) &intens;en &parte;\.$"
   name="penetrante_enemigo"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Penetrantes"
   match="^\* (.*?) te intenta (perforar|pinchar) en &parte;\, pero logras parar su ataque\.$"
   name="penetrante_enemigo_parado"
   regexp="y"
   sequence="100"
   script="on_fallar"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Penetrantes"
   match="^&prefijo;\* (.*?) te intenta (perforar|pinchar) en &parte;\, pero logras parar críticamente su ataque\.$"
   name="penetrante_enemigo_parado_critico"
   regexp="y"
   sequence="100"
   script="on_fallar"
  >
  </trigger>
  <trigger
   enabled="y"
   group="Penetrantes"
   match="^&prefijo;\* (.*?) perfora en &parte; cuando se lanza sobre ti clavándote críticamente su (.*?)\.$"
   name="penetrante_enemigo_critico"
   regexp="y"
   sequence="100"
   script="on_golpear"
  >
  </trigger>
</triggers>

<triggers>
  <!-- Otros -->

  <trigger
   enabled="y"
   group="Combate"
   match="^&prefijo;Estás siendo atacad[a,o] por (.*?)\.$"
   regexp="y"
   send_to="12"
   sequence="100"
  >
  <send>play_sound("generales/matarwav")</send>
  </trigger>
</triggers>

<script>
<![CDATA[
require "rl_stuff"

-- Un listado de las armas que pueden hacerse sonar...
local armas_predef = {
	cortante = {
		ruta = "combate/armas/cortantes",
		ext = "ogg",
		min = 1,
		max = 9,
	},
	sable = {
		ruta = "combate/armas/cortantes",
		ext = "ogg",
		min = 1,
		max = 9,
	},
	penetrante = {
		ruta = "combate/armas/penetrantes",
		ext = "ogg",
		min = 1,
		max = 15,
	},
	lanza_diamante = {
		ruta = "combate/armas/penetrantes/lanza de diamante",
		ext = "ogg",
		min = 1,
		max = 4,
	},
	aplastante = {
		ruta = "combate/armas/aplastantes",
		ext = "ogg",
		min = 1,
		max = 9,
	},
	desarmado = {
		ruta = "combate/armas/desarmado",
		ext = "ogg",
		min = 1,
		max = 26,
	},
	lacerante = {},
}

function OnPluginListChanged()
	RLStuffListChanged()
end -- function

function on_golpear(name, line, wc)
	local params = utils.split(name, "_")
	local arma, propio, critico = params[1], params[2] == "propio", params[3] ~= nil
	
	-- Obtenemos el registro para el amra indicada
	local t_arma = armas_predef[arma]
	local ruta_sonido = ""
	
	-- Solo para golpes que no son críticos
	if not critico then
		ruta_sonido = t_arma.ruta.."/"..math.random(t_arma.min, t_arma.max) .. "." .. t_arma.ext
	else
		ruta_sonido = t_arma.ruta.."/critico."..t_arma.ext
	end -- if
	
	if propio then
		play_sound(ruta_sonido, 50)
	else
		play_sound(ruta_sonido, -50)
	end -- if
end -- function

function on_fallar(name,line,wildcards)
	local params = utils.split(name, "_")
	local arma, enemigo, esquivado, critico = params[1], params[2] == "enemigo", params[3] == "esquivado", params[4] ~= nil

	local ruta_sonido, pan_sonido = nil, nil

	if esquivado then
		ruta_sonido = "combate/esquivar/"..math.random(1, 15)..".ogg"
	else
		ruta_sonido = "combate/parar/"..math.random(1, 29)..".ogg"
	end -- if
	
	if critico then
		pan_sonido = 20
	else
		pan_sonido = 50
	end -- if
	
	if enemigo then
		pan_sonido = -pan_sonido
	end -- if
	
	play_sound(ruta_sonido, pan_sonido)
end -- function
]]>
</script>
</muclient>
