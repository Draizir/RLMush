<?xml version="1.0" encoding="iso8859-15"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, December 09, 2008, 2:04 PM -->
<!-- MuClient version 4.37 -->
<!-- Tomado del plugin MushReader original, por Tyler Spivey -->

<!-- Plugin "tts_NVDA" generated by Plugin Wizard -->

<muclient>
<plugin
   name="mush_tolk"
   author="Francisco R. Del Roio"
   id="16ba6b7a227a9dab54f5c76e"
   language="Lua"
   purpose="Plugin para lectores de pantalla"
   save_state="y"
   date_written="2017-05-07 09:54:00"
   requires="4.90"
   version="1.0"
   >

</plugin>
<aliases>
  <alias
   match="tts_stop"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>silence()</send>
  </alias>
  <alias
   match="tts_interrupt *"
   enabled="y"
   send_to="12"
   sequence="100"
   script="on_interrupt"
  >
  </alias>
  <alias
   match="tts_note *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>output([[%1]])</send>
  </alias>

  <alias
   script="TTSToggle"
   match="tts"
   enabled="y"
   group="TTS"
   omit_from_command_history="y"
   omit_from_log="y"
   omit_from_output="y"
   sequence="100"
  >
  </alias>
</aliases>


<!--  Get our standard constants -->

<script>
<![CDATA[
require("ppi")
require "luatolk"

local tts_enabled = true
local ignorar_sig = false

function OnPluginInstall ()
	luatolk.Load()
	output("MushReader inicializado.", true)
end -- OnPluginInstall

function OnPluginClose()
	luatolk.Unload()
end -- function

function output(str, interrumpir)
	return luatolk.Output(str, interrumpir)
end -- output

function silence()
	return luatolk.Silence()
end

function braille(str)
	return luatolk.Braille(str)
end -- function

function isLoaded()
	return luatolk.IsLoaded()
end

function detectScreenReader()
	return luatolk.DetectScreenReader()
end -- function

function hasBraille()
	return luatolk.HasBraille()
end

function hasSpeech()
	return luatolk.HasSpeech()
end

function ignore_next()
	ignorar_sig = true
end -- function

function output_next()
	ignorar_sig = false
end -- function

function OnPluginScreendraw(t, log, line)
	if not tts_enabled then
		return
	end --tts off
	
	-- We don't want input lines to be spoken
	if t == 2 then
		return
	end -- if
	
	-- checking for an empty string, or a string composed only of spaces.
	-- If we don't, NVDA says blank.
	if (t == 0 or t == 1) then
		if line:find("^%s*$") then
			return
		end -- if
		
		if ignorar_sig then
			ignorar_sig = false
			return
		end -- if
		output(line)
	end
end --function

function TTSToggle (name, line, wc)
	if tts_enabled then
		tts_enabled = false
		output("Voz desactivada", true)
	else
		tts_enabled = true
		output("Voz activada", true)
	end
end

function OnPluginTabComplete(word)
	if tts_enabled then
		output(word, true)
	end
end -- function

function on_interrupt(name, line, wildcards)
	output(utf8convert(wildcards[1]), true)
end -- function

]]>            
</script> 
</muclient>
